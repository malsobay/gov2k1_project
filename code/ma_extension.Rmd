---
title: "Gov2k1 Final Paper"
author: "Mohammed Alsobay"
date: "11/24/2021"
output: pdf_document
---

```{r, include=FALSE}
library(tidyverse)
library(ggplot2)
library(here)
library(lme4)
library(stargazer)
library(coefplot)
library(ggstance)
library(broom)
library(data.table)
here::here()

getwd()
```

## Preprocessing

```{r}
tweet_cols = c("Tweet1_1", "Tweet1_2", "Tweet1_3",
               "Tweet2_1", "Tweet2_2", "Tweet2_3",
               "Tweet3_1", "Tweet3_2", "Tweet3_3",
               "Tweet4_1", "Tweet4_2", "Tweet4_3",
               "Tweet5_1", "Tweet5_2", "Tweet5_3",
               "Tweet6_1", "Tweet6_2", "Tweet6_3",
               "Tweet7_1", "Tweet7_2", "Tweet7_3",
               "Tweet8_1", "Tweet8_2", "Tweet8_3")

sec_tweets = c(1,2,3,5)
countersec_tweets = c(4,6,7,8)


# %>% select(c(tweet_cols, "Id", "Prmt", "Sect"))
df = read_csv("data/survey_data.csv")  %>%
  mutate(treatment = as.factor(case_when(Prmt == 1 ~ "Control",
                                         Prmt == 2 ~ "Religious",
                                         Prmt == 3 ~ "National",
                                         Prmt == 4 ~ "ReligiousElite",
                                         Prmt == 5 ~ "NationalElite")),
         Id = as.factor(Id),
         Sect = as.factor(case_when(Sect == 1 ~ "Maronite",
          Sect == 2 ~ "Greek Orthodox",
          Sect == 3 ~ "Catholic",
          Sect == 5 ~ "Armenian Orthodox",
          Sect == 6 ~ "Armenian Catholic",
          Sect == 7 ~ "Sunni",
          Sect == 8 ~ "Shia",
          Sect == 9 ~ "Druze",
          Sect == 10 ~ "Alawite",
          Sect == 11 ~ "Christian min."))) 

df$sect_coarse = as.factor(ifelse(df$Sect %in% c("Sunni", "Shia", "Druze"), yes = as.character(df$Sect), no="Christian"))
df$Sect = relevel(df$Sect, ref="Shia")
df$sect_coarse = relevel(df$sect_coarse, ref="Shia")

isna_cols = paste("isna_", tweet_cols, sep="")

df[,isna_cols] = df %>% select(tweet_cols) %>% is.na() 

df = df %>% mutate(anyna_tweet1 = isna_Tweet1_1 | isna_Tweet1_2 | isna_Tweet1_3,
                   anyna_tweet2 = isna_Tweet2_1 | isna_Tweet2_2 | isna_Tweet2_3,
                   anyna_tweet3 = isna_Tweet3_1 | isna_Tweet3_2 | isna_Tweet3_3,
                   anyna_tweet5 = isna_Tweet5_1 | isna_Tweet5_2 | isna_Tweet5_3,
                   anyna_tweet4 = isna_Tweet4_1 | isna_Tweet4_2 | isna_Tweet4_3,
                   anyna_tweet6 = isna_Tweet6_1 | isna_Tweet6_2 | isna_Tweet6_3,
                   anyna_tweet7 = isna_Tweet7_1 | isna_Tweet7_2 | isna_Tweet7_3,
                   anyna_tweet8 = isna_Tweet8_1 | isna_Tweet8_2 | isna_Tweet8_3,
                   relig_index = df %>% select(matches("relig[0-9]")) %>% rowMeans(),
                   sectarian_index = df %>% select(matches("sectarian[0-9]")) %>% rowMeans(),
                   sectsj_index = df %>% select(matches("sectsj[0-9]")) %>% rowMeans(),
                   mcp_index = df %>% select(matches("mcp[0-9]")) %>% rowMeans())


```


# Todos and Qs:

* Should we try to split the treatment into 2 levels (message and elite) to try and measure the impact of each separately? 
* Druze excluded in religious ID treatment 


# Part 1: Aggregation obscures important item-level differences 
In CITE PAPER, the authors conduct two experiments to estimate the effect of counter-sectarian primes on sectarian attitudes: one on Twitter, and another through a field survey. In this section, we respond to the survey experiment, highlighting experimental and analytical decisions that we believe obscure important underlying dynamics of the phenomenon of interest, and the context in which it was studied. 

In the survey experiment, a firm approached a representative sample of Lebanese society and asked them to rate a total of 8 tweets, 4 of which were "sectarian" and 4 of which were "counter-sectarian" in nature. The participants were asked to rate the content of the tweet itself, the person who wrote the tweet, and how likely they were to share the tweet themselves, all on a scale of 1-10. Participants were randomly assigned to either a control condition, or to receiving one of four priming statements before rating the tweets (translated from Arabic by the authors):

* __Control statement:__ Over the past few years, there has been arise in sectarian tensions in Lebanon and across the Middle East. 
* __National identity prime:__ Over the past few years, there has been arise in sectarian tensions in Lebanon and across the Middle East. _But many people agree that their sect does not make them better than anyone else. They agree that we are all Lebanese and we all should be equal. We all live on one land. We share the same history and the same future; we share the same culture, the same food, and language. Most importantly, we share a common Lebanese identity._
* __Religious identity prime:__ Over the past few years, there has been arise in sectarian tensions in Lebanon and across the Middle East. _But many people agree that their sect does not make them better than anyone else. They agree that we all believe in one God and we should all be equal. We all live on one land, we share the same history and the same future; we share the same culture, the same food, and language. Most importantly, we share a common belief in God._ 
* __Elite-endorsed national ID prime:__ " Over the past few years, there has been a rise in sectarian tensions in Lebanon and across the Middle East. _But many prominent politicians including members of the March 8 bloc, the March 14 bloc, and independents have called for people to come together. They agree that we are all Lebanese..._
* __Elite-endorsed religious ID prime:__ " Over the past few years, there has been a rise in sectarian tensions in Lebanon and across the Middle East. _But many prominent Christian, Sunni, and Shia religious leaders have issued religious decrees calling for people to come together and stop inciting sectarian hatreds. They agree that we all believe in one God..._

The original paper measures the treatment effects on three outcomes of interest: (1) the average rating across all sectarian tweets; (2) the average rating across all counter-sectarian tweets; and (3) total counter-sectarian sentiment, which they operationalize as the difference between (2) and (1). In this response, we argue that this aggregation obscures important heterogeneity in sentiment and response patterns. 

# 1. Disaggregation exposes a more complex sectarian-political dynamic 
The paper reports that the each of the sectarian tweets targets a single sect, with the targeted sects being Sunnis, Shia, Christians, and Druze. On the other hand, the counter-sectarian tweets are generically counter-sectarian, i.e. they call for unity, but do not promote a specific sect. Consequently, it would be reasonable to expect different treatment efficacy for each of the sectarian tweets, which we do indeed observe in Figure 1, which shows the treatment effect on each of the outcomes (the columns), for each of the tweets (the colors).


### The problem with aggregation: 
In addition to the heterogenous effects at the item-level, the aggregation as performed in the paper fatally flaws the external validity of its findings. As confirmed in communication with the authors, survey subjects occasionally refused to answer some of the evaluations, and these were recorded in the data as null values. Consequently, when aggregating across tweets by taking an average, any participant that refused to evaluate any of the relevant tweets would have a null value for their aggregated measure. Out of 500 participants, 143 refused to evaluate at least one sectarian tweet, 91 refused to evaluate at least one counter-sectarian tweet, and a total of 177 fell in either group. This not only dramatically shrinks the sample size, but also invalidates the work that the expensive surveying firm was hired to do: the sample is no longer representative of Lebanon as a whole, but of those that agreed to evaluate each and every tweet, which is a subsample that may differ considerably. 

```{r}
df$isna_sec_tweet_eval = df %>% select(matches("isna_Tweet[1235]_1")) %>% rowSums() > 0

bind_rows(table(df$Sect) / length(df$Sect),
table((df %>% filter(isna_sec_tweet_eval))$Sect) / length((df %>% filter(isna_sec_tweet_eval))$Sect),
table((df %>% filter(!isna_sec_tweet_eval))$Sect) / length((df %>% filter(!isna_sec_tweet_eval))$Sect))



table((df %>% filter(isna_sec_tweet_eval))$Sect) / table(df$Sect)

```






To contextualize the differences observed between individual tweets in the survey experiment, we contacted the authors for the exact phrasing of the tweets used in Arabic. As native Arabic speakers, we are able to faithfully translate these into English below, and discuss how the nuance of the phrasing affects this experiment: 

__Sectarian tweets:__ 
1. Now the Arab people (or most of them) are certain that _Hezb Al-lat_ is a barbaric, destructive arm of Iran in the region and that it supports its _rawafid_ followers #HezbAllah_is_Lebanons_Destruction 

2. I am a muslim [translator note: female] and I hate non-believers because they do not worship God [Allah]. 

3. To the Christians of the March 8 bloc, how can you allow your future generations to live like you, as followers of an armed party that assassinated the best men of Lebanon? #Lebanon needs a new generation 

4. #Shia muslims spend the night praying to God [Allah] on _Laylat Ul-Qadr_ [translator note: one of the holiest nights of the year in Islam], while _Da'esh_ [ISIS] scum blow up a masjid they are praying in. _Hasbuna Allah Wa Neam Alwakeel_ [translator note: sect-neutral religious saying along the lines of "We leave this to God, and he is the best agent."] #Kabul 


First, we note that contrary to the paper's claim, none of the tweets refer to Druze specifically. Second, it's important to note that, with the exception of #2, each of these sectarian tweets is confounded by considerable geopolitical undertones: #1 refers to Iran, #3 is more readily interpreted as an attack on either of the "Free Patriotic Movement" or "Marada" parties, and #4 mixes in the complexities of ISIS perception. 

Tweet #2 highlights a glaring contradiction in the experimental design; although it promotes a form of hate, that hate is more accurately described as "anti-atheist" rather than sectarian, as it describes a lack of belief and worship of God. All the primes emphasize shared identity, with the religious primes specifically highlighting a shared belief in God among religions, and this is likely why we observe that the primes actually _increase_ support for this tweet (with the exception of the religious elite prime, which has no effect). This example alone highlights the heterogeneity in item-level response and potential unintended harms, which is enough to warrant the  disaggregation of the analysis. 

Although the religious elite prime is touted as decreasing support for sectarian tweets, we find that this conclusion is only supported for two out of the four tweets, namely #1 and #4. 


There are a few points to highlight here: 

2. If the goal of getting a nationally representative sample is to estimate the effect of nationally broadcasting such primes, then the aggregated QoI implies that each of these messages is broadcast in equal proportion -- this isn't true, so we can't take these results to be indiciative of total societal gain from such an intervention 
2. The religious elite prime notably excludes druze -- no interaction observed but difficult to measure because so few of them -- despite this, interesting interaction in tweet 6 



### Fig 1. Treatment effects measured on each sectarian tweet 

```{r, out.width=10}
lm_summaries = data.frame()

for (tweet_number in c(1,2,3,5)) {
  for (outcome_number in c(1,2,3)) {
    lm_temp = lm(paste("Tweet",tweet_number,"_",outcome_number,"~treatment", sep=""), data=df)
    lm_summaries = bind_rows(lm_summaries, 
                             tidy(lm_temp) %>% 
                               mutate(tweet_number = tweet_number,
                                      outcome_number = outcome_number))
  }
}

lm_summaries = lm_summaries %>% mutate(tweet_number = as.factor(tweet_number), outcome_number = as.factor(outcome_number))
lm_summaries$outcome_label = factor(case_when(lm_summaries$outcome_number == 1 ~ "Tweet Rating",
                                       lm_summaries$outcome_number == 2 ~ "User Rating",
                                       lm_summaries$outcome_number == 3 ~ "Likelihood to Share"))

#Summarizing plot 
lm_summaries %>% filter(term != "(Intercept)") %>%  
  ggplot(aes(x=estimate, y=term, xmin=estimate-1.96*std.error, xmax=estimate+1.96*std.error, color=tweet_number)) + 
  labs(title="Sectarian tweets") + 
  geom_point(position=ggstance::position_dodgev(height=0.5)) +
  geom_errorbar(position=ggstance::position_dodgev(height=0.5)) + 
  geom_vline(xintercept=0) + 
  facet_grid(.~factor(outcome_label, levels=c("Tweet Rating", "User Rating", "Likelihood to Share")))


```

## Interactions

### Sectarian

```{r, fig.width=15}

lm_summaries = data.frame()

for (tweet_number in c(1,2,3,5)) {
  for (outcome_number in c(1,2,3)) {
    lm_temp = lm(paste("Tweet",tweet_number,"_",outcome_number,"~treatment*sect_coarse", sep=""), data=df)
    lm_summaries = bind_rows(lm_summaries, 
                             tidy(lm_temp) %>% 
                               mutate(tweet_number = tweet_number,
                                      outcome_number = outcome_number))
  }
}

lm_summaries = lm_summaries %>% mutate(tweet_number = as.factor(tweet_number), outcome_number = as.factor(outcome_number))


# lm_summaries %>% filter(outcome_number == 1 & (lm_summaries$term %like% ":")) %>%  
#   ggplot(aes(x=estimate, y=term, xmin=estimate-1.96*std.error, xmax=estimate+1.96*std.error, color=tweet_number)) + 
#   geom_point(position=ggstance::position_dodgev(height=0.5)) +
#   labs(title="Tweet Rating") +
#   geom_errorbar(position=ggstance::position_dodgev(height=0.5)) + 
#   geom_vline(xintercept=0)


lm_summaries %>% filter((lm_summaries$term %like% "treatment")) %>%  
  ggplot(aes(x=estimate, y=term, xmin=estimate-1.96*std.error, xmax=estimate+1.96*std.error, color=tweet_number)) + 
  labs(title="Sectarian tweets") + 
  geom_point(position=ggstance::position_dodgev(height=0.5)) +
  geom_errorbar(position=ggstance::position_dodgev(height=0.5)) + 
  geom_vline(xintercept=0) + 
  facet_grid(.~outcome_number)

```

### Countersec 

```{r, fig.width=15}

lm_summaries = data.frame()

for (tweet_number in c(4, 6,7,8)) {
  for (outcome_number in c(1,2,3)) {
    lm_temp = lm(paste("Tweet",tweet_number,"_",outcome_number,"~treatment*sect_coarse", sep=""), data=df)
    lm_summaries = bind_rows(lm_summaries, 
                             tidy(lm_temp) %>% 
                               mutate(tweet_number = tweet_number,
                                      outcome_number = outcome_number))
  }
}

lm_summaries = lm_summaries %>% mutate(tweet_number = as.factor(tweet_number), outcome_number = as.factor(outcome_number))


# lm_summaries %>% filter(outcome_number == 1 & (lm_summaries$term %like% ":")) %>%  
#   ggplot(aes(x=estimate, y=term, xmin=estimate-1.96*std.error, xmax=estimate+1.96*std.error, color=tweet_number)) + 
#   geom_point(position=ggstance::position_dodgev(height=0.5)) +
#   labs(title="Tweet Rating") +
#   geom_errorbar(position=ggstance::position_dodgev(height=0.5)) + 
#   geom_vline(xintercept=0)


lm_summaries %>% filter((lm_summaries$term %like% "treatment")) %>%  
  ggplot(aes(x=estimate, y=term, xmin=estimate-1.96*std.error, xmax=estimate+1.96*std.error, color=tweet_number)) + 
  labs(title="Countersec tweets") + 
  geom_point(position=ggstance::position_dodgev(height=0.5)) +
  geom_errorbar(position=ggstance::position_dodgev(height=0.5)) + 
  geom_vline(xintercept=0) + 
  facet_grid(.~outcome_number)

```



# Non-response (NR) patterns 

## Patterns of NR

* break down into unit and item-level patterns 

```{r}



#Look at blocks of behavior 
(df %>% group_by(across(all_of(isna_cols))) %>% count() %>% arrange(desc(n)))[6,]

#Average by columns
df %>% select(tweet_cols) %>% is.na() %>% colMeans() %>% sort(decreasing = TRUE) 
df %>% select(tweet_cols) %>% is.na() %>% colMeans() 

```


# Predicting nonresponse 

```{r}
df %>% select(matches("any")) %>% colMeans()


stargazer(lm(anyna_tweet1 ~ sect_coarse + polinterest + socmedia, data=df),
          lm(anyna_tweet2 ~ sect_coarse + polinterest + socmedia, data=df),
          lm(anyna_tweet3 ~ sect_coarse + polinterest + socmedia, data=df),
          lm(anyna_tweet5 ~ sect_coarse + polinterest + socmedia, data=df), type="text")

stargazer(lm(anyna_tweet1 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet2 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet3 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet5 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet4 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet6 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet7 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df),
          lm(anyna_tweet8 ~ sect_coarse + polinterest + socmedia + relig_index + sectarian_index + sectsj_index + mcp_index, data=df), type="text")

```

